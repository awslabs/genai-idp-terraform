# Copyright Amazon.com, Inc. or its affiliates. All rights reserved.
# SPDX-License-Identifier: Apache-2.0
#
variable "region" {
  description = "AWS region to deploy resources"
  type        = string
  default     = "us-east-1"
}

variable "prefix" {
  description = "Prefix to add to resource names"
  type        = string
  default     = "idp"
}

# VPC Configuration
variable "vpc_cidr" {
  description = "CIDR block for the VPC (only used when creating new VPC)"
  type        = string
  default     = "10.0.0.0/16"
}

variable "vpc" {
  description = "Existing VPC configuration. If provided, will use existing VPC instead of creating new one. All properties must be provided together."
  type = object({
    vpc_id                 = string
    vpc_subnet_ids         = list(string)
    vpc_security_group_ids = list(string)
  })
  default = null

  validation {
    condition = var.vpc == null || (
      try(var.vpc.vpc_id, null) != null &&
      try(length(var.vpc.vpc_subnet_ids), 0) > 0 &&
      try(length(var.vpc.vpc_security_group_ids), 0) > 0
    )
    error_message = "When vpc is provided, all properties (vpc_id, vpc_subnet_ids, vpc_security_group_ids) must be specified with valid values."
  }
}

variable "log_level" {
  description = "The log level for the document processing components"
  type        = string
  default     = "INFO"
  validation {
    condition     = contains(["DEBUG", "INFO", "WARNING", "ERROR", "CRITICAL"], var.log_level)
    error_message = "Allowed values for log_level are \"DEBUG\", \"INFO\", \"WARNING\", \"ERROR\", or \"CRITICAL\"."
  }
}

variable "log_retention_days" {
  description = "The retention period for CloudWatch logs generated by the document processing components in days"
  type        = number
  default     = 7
  validation {
    condition     = contains([1, 3, 5, 7, 14, 30, 60, 90, 120, 150, 180, 365, 400, 545, 731, 1827, 3653], var.log_retention_days)
    error_message = "Log retention days must be one of the allowed values."
  }
}

variable "data_tracking_retention_days" {
  description = "The retention period for document tracking data in days"
  type        = number
  default     = 365
}

# Evaluation Configuration
variable "enable_evaluation" {
  description = "Enable evaluation functionality (simplified flag)"
  type        = bool
  default     = false
}

variable "evaluation_model_id" {
  description = "Model ID for evaluation processing"
  type        = string
  default     = null
}

# Reporting Configuration
variable "enable_reporting" {
  description = "Enable reporting functionality (simplified flag)"
  type        = bool
  default     = false
}

# Model Configuration
variable "classification_model_id" {
  description = "Model ID for document classification (Bedrock LLM processor only)"
  type        = string
  default     = null
}

variable "extraction_model_id" {
  description = "Model ID for information extraction (Bedrock LLM processor only)"
  type        = string
  default     = null
}

variable "summarization_enabled" {
  description = "Enable document summarization for Bedrock LLM processor"
  type        = bool
  default     = true
}

variable "summarization_model_id" {
  description = "Model ID for document summarization"
  type        = string
  default     = null
}



# Configuration File Path
variable "config_file_path" {
  description = "Path to the configuration YAML file for document processing"
  type        = string
  default     = "../../sources/config_library/pattern-2/lending-package-sample/config.yaml"
}

variable "tags" {
  description = "Tags to apply to all resources"
  type        = map(string)
  default     = {}
}

# API Configuration (New Consolidated Structure)
variable "api" {
  description = "API configuration for processing environment features"
  type = object({
    enabled = optional(bool, false)
    
    agent_analytics = optional(object({
      enabled  = optional(bool, false)
      model_id = optional(string, "us.anthropic.claude-3-haiku-20240307-v1:0")
    }), { enabled = false })
    
    discovery = optional(object({
      enabled = optional(bool, false)
    }), { enabled = false })
    
    chat_with_document = optional(object({
      enabled                  = optional(bool, false)
      guardrail_id_and_version = optional(string, null)
    }), { enabled = false })
    
    process_changes = optional(object({
      enabled = optional(bool, false)
    }), { enabled = false })
    
    knowledge_base = optional(object({
      enabled            = optional(bool, false)
      knowledge_base_arn = optional(string, null)
      model_id           = optional(string, "us.amazon.nova-pro-v1:0")
      embedding_model_id = optional(string, "amazon.titan-embed-text-v2:0")
    }), { enabled = false })
  })
  default = { enabled = false }
}

# DEPRECATED: Individual API feature variables (for backward compatibility)
# These will be removed in a future version. Use the consolidated 'api' variable instead.

variable "discovery" {
  description = "DEPRECATED: Use api.discovery instead. Configuration for document discovery functionality"
  type = object({
    enabled = optional(bool, false)
  })
  default = null
}

variable "chat_with_document" {
  description = "DEPRECATED: Use api.chat_with_document instead. Configuration for chat with document functionality"
  type = object({
    enabled                  = optional(bool, false)
    guardrail_id_and_version = optional(string, null)
  })
  default = null
}

variable "process_changes" {
  description = "DEPRECATED: Use api.process_changes instead. Configuration for document editing and reprocessing functionality"
  type = object({
    enabled = optional(bool, false)
  })
  default = null
}

variable "admin_email" {
  description = "Administrator email address for notifications and access"
  type        = string
  default     = null
}
