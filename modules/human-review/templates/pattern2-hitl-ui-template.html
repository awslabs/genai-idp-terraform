<!DOCTYPE html>
<html>
<head>
    <title>Pattern-2 Document Review - Professional Interface</title>
    <script src="https://assets.crowd.aws/crowd-html-elements.js"></script>
    <style>
        :root {
            --primary-blue: #0073e6;
            --secondary-blue: #e6f3ff;
            --dark-blue: #004d99;
            --light-gray: #f8f9fa;
            --border-gray: #dee2e6;
            --success-green: #28a745;
            --warning-red: #dc3545;
            --text-dark: #212529;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * { box-sizing: border-box; }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
            background: var(--light-gray);
        }
        
        .container { 
            display: flex; height: 100vh;
            box-shadow: var(--shadow);
        }
        
        .image-pane { 
            width: 65%; padding: 15px;
            background: white; position: relative;
            border-right: 2px solid var(--border-gray);
        }
        
        .review-pane { 
            width: 35%; padding: 15px;
            display: flex; flex-direction: column;
            background: var(--light-gray);
        }
        
        .controls-bar {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 15px;
            padding: 10px; background: var(--secondary-blue);
            border-radius: 6px; box-shadow: var(--shadow);
        }
        
        .image-controls { 
            display: flex; gap: 8px; align-items: center;
        }
        
        .image-controls button {
            background: var(--primary-blue);
            color: white; border: none;
            padding: 6px 12px; border-radius: 4px;
            cursor: pointer; font-size: 12px;
            transition: all 0.2s ease;
            min-width: 32px;
        }
        
        .image-controls button:hover {
            background: var(--dark-blue);
            transform: translateY(-1px);
        }
        
        .image-container {
            position: relative; overflow: auto;
            height: calc(100vh - 80px);
            border: 1px solid var(--border-gray);
            border-radius: 6px; background: white;
            cursor: grab;
        }
        
        .image-wrapper {
            display: inline-block;
            min-width: 100%;
            min-height: 100%;
            text-align: center;
        }
        
        #documentImage { 
            display: block; margin: 0 auto;
            max-width: none; max-height: none;
            border-radius: 4px;
            transform-origin: center center;
        }
        
        .highlight-box {
            position: absolute; z-index: 10;
            border: 3px solid var(--primary-blue);
            background: rgba(0,115,230,0.15);
            pointer-events: none; border-radius: 2px;
            box-shadow: 0 0 10px rgba(0,115,230,0.3);
        }
        
        .document-info { 
            background: white; padding: 15px;
            border-radius: 8px; margin-bottom: 15px;
            box-shadow: var(--shadow); border-left: 4px solid var(--primary-blue);
        }
        
        .info-toggle {
            cursor: pointer; display: flex;
            justify-content: space-between; align-items: center;
            color: var(--primary-blue); font-weight: 600;
        }
        
        .info-content {
            margin-top: 10px; display: none;
            font-size: 13px; color: var(--text-dark);
        }
        
        .info-content.expanded { display: block; }
        
        .scroll-container {
            flex: 1; overflow-y: auto;
            padding-right: 8px; max-height: calc(100vh - 300px);
        }
        
        .key-value-pair { 
            margin-bottom: 15px; padding: 15px;
            border: 1px solid var(--border-gray);
            border-radius: 8px; background: white;
            transition: all 0.2s ease; cursor: pointer;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .key-value-pair:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border-color: var(--primary-blue);
        }
        
        .key-value-pair label {
            display: block; font-weight: 600;
            color: var(--primary-blue); margin-bottom: 8px;
            font-size: 14px;
        }
        
        .confidence-display {
            display: flex; justify-content: space-between;
            align-items: center; font-size: 12px;
            margin-top: 5px;
        }
        
        .confidence-score {
            font-weight: 600; padding: 2px 6px;
            border-radius: 3px;
        }
        
        .confidence-low { 
            color: var(--warning-red);
            background: rgba(220,53,69,0.1);
        }
        
        .confidence-high { 
            color: var(--success-green);
            background: rgba(40,167,69,0.1);
        }
        
        .missing-value {
            color: var(--warning-red);
            font-size: 12px; margin-top: 5px;
            padding: 5px; background: rgba(220,53,69,0.1);
            border-radius: 3px; border-left: 3px solid var(--warning-red);
        }
        
        .tab-container {
            background: white; border-radius: 8px;
            box-shadow: var(--shadow); margin-bottom: 15px;
        }
        
        .tab-buttons {
            display: flex; border-bottom: 1px solid var(--border-gray);
        }
        
        .tab-button {
            flex: 1; padding: 12px; text-align: center;
            background: var(--light-gray); border: none;
            cursor: pointer; font-weight: 600;
            color: var(--text-dark); transition: all 0.2s ease;
            border-radius: 8px 8px 0 0;
        }
        
        .tab-button.active {
            background: white; color: var(--primary-blue);
            border-bottom: 2px solid var(--primary-blue);
        }
        
        .tab-content {
            padding: 15px; display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .instructions-list {
            list-style: none; padding: 0; margin: 0;
        }
        
        .instructions-list li {
            padding: 10px 0; border-bottom: 1px solid #f0f0f0;
            display: flex; align-items: flex-start; gap: 10px;
        }
        
        .step-number {
            background: var(--primary-blue); color: white;
            width: 24px; height: 24px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; font-weight: 600; flex-shrink: 0;
        }
        
        .verification-section {
            background: white; padding: 15px;
            border-radius: 8px; margin-top: 15px;
            box-shadow: var(--shadow); border-left: 4px solid var(--success-green);
        }
        
        .verification-checkbox {
            display: flex; align-items: center;
            gap: 10px; margin-bottom: 15px;
        }
        
        .verification-checkbox input[type="checkbox"] {
            width: 18px; height: 18px;
            accent-color: var(--success-green);
        }
        
        .submit-button {
            background: var(--success-green);
            color: white; border: none;
            padding: 12px 24px; border-radius: 6px;
            cursor: pointer; font-weight: 600;
            width: 100%; opacity: 0.5; pointer-events: none;
        }
        
        .submit-button.enabled {
            opacity: 1; pointer-events: auto;
        }
        
        h3 { 
            color: var(--primary-blue); margin: 0 0 15px 0;
            font-size: 18px; font-weight: 600;
        }
    </style>
</head>
<body>
    <crowd-form>
        <div class="container">
            <!-- Image Pane -->
            <div class="image-pane">
                <div class="controls-bar">
                    <div class="image-controls">
                        <button type="button" onclick="zoomIn()">Zoom In (+)</button>
                        <button type="button" onclick="zoomOut()">Zoom Out (-)</button>
                        <button type="button" onclick="resetView()">Reset</button>
                    </div>
                    <div style="color: var(--primary-blue); font-weight: 600;">
                        Pattern-2 Document Viewer
                    </div>
                </div>
                <div class="image-container" id="imageContainer">
                    <div class="image-wrapper" id="imageWrapper">
                        <img id="documentImage" 
                            src="{{ task.input.sourceDocument | grant_read_access }}" 
                            onload="initImage()">
                    </div>
                </div>
            </div>

            <!-- Review Pane -->
            <div class="review-pane">
                <div class="document-info">
                    <div class="info-toggle" onclick="toggleInfo()">
                        <span>üìÑ Document Information</span>
                        <span id="toggleIcon">‚ñº</span>
                    </div>
                    <div class="info-content" id="infoContent">
                        <p><strong>Document Class:</strong> {{ task.input.documentClass | escape }}</p>
                        <p><strong>Section ID:</strong> {{ task.input.sectionId | escape }}</p>
                        <p><strong>Page:</strong> {{ task.input.pageNumber }}</p>
                        <p><strong>Confidence Threshold:</strong> {{ task.input.confidenceThreshold | round: 2 }}</p>
                        <p><strong>Execution ID:</strong> {{ task.input.executionId | escape }}</p>
                    </div>
                </div>

                <!-- Tab Container -->
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button type="button" class="tab-button active" onclick="switchTab('review')">üìã Review</button>
                        <button type="button" class="tab-button" onclick="switchTab('instructions')">üìñ Instructions</button>
                    </div>
                    
                    <!-- Review Tab Content -->
                    <div id="reviewTab" class="tab-content active">
                        <div class="scroll-container">
                            <h3>üîç Field Review</h3>
                            {% for pair in task.input.keyValuePairs %}
                                <div class="key-value-pair" 
                                    data-key="{{ pair.key | escape }}"
                                    onclick="highlightField(this)">
                                    <label>{{ pair.key | escape }}</label>
                                    <crowd-input 
                                        name="{{ pair.key | escape }}" 
                                        value="{{ pair.value | escape }}">
                                    </crowd-input>
                                    <div class="confidence-display">
                                        <span class="confidence-score confidence-{% if pair.confidence < task.input.confidenceThreshold %}low{% else %}high{% endif %}">
                                            {{ pair.confidence | round: 2 }}
                                        </span>
                                        <span style="color: #6c757d; font-size: 11px;">
                                            Threshold: {{ task.input.confidenceThreshold | round: 2 }}
                                        </span>
                                    </div>
                                    {% if pair.value == "" %}
                                        <div class="missing-value">
                                            ‚ö†Ô∏è Value missing - please verify and complete
                                        </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Instructions Tab Content -->
                    <div id="instructionsTab" class="tab-content">
                        <div class="scroll-container">
                            <h3>üìñ Pattern-2 Review Instructions</h3>
                            <ul class="instructions-list">
                                <li>
                                    <div class="step-number">1</div>
                                    <div class="step-text">
                                        <strong>View the Document:</strong> Use zoom controls to examine the document clearly.
                                    </div>
                                </li>
                                <li>
                                    <div class="step-number">2</div>
                                    <div class="step-text">
                                        <strong>Check Confidence Scores:</strong> Red scores are below threshold and need attention.
                                    </div>
                                </li>
                                <li>
                                    <div class="step-number">3</div>
                                    <div class="step-text">
                                        <strong>Verify and Edit:</strong> Compare extracted values with the document. Edit any incorrect values.
                                    </div>
                                </li>
                                <li>
                                    <div class="step-number">4</div>
                                    <div class="step-text">
                                        <strong>Complete Missing Values:</strong> Fields marked with ‚ö†Ô∏è need values filled in.
                                    </div>
                                </li>
                                <li>
                                    <div class="step-number">5</div>
                                    <div class="step-text">
                                        <strong>Submit:</strong> Check the verification box and submit your review.
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Verification Section -->
                <div class="verification-section">
                    <div class="verification-checkbox">
                        <input type="checkbox" id="reviewComplete" onchange="toggleSubmit()">
                        <label for="reviewComplete">I have reviewed all fields and verified their accuracy</label>
                    </div>
                    <crowd-button 
                        id="submitButton"
                        class="submit-button"
                        form-action="submit" 
                        variant="primary"
                        disabled="true">
                        ‚úì Submit Review
                    </crowd-button>
                </div>
            </div>
        </div>

        <!-- Hidden inputs for context -->
        <input type="hidden" name="documentId" value="{{ task.input.documentId | escape }}">
        <input type="hidden" name="sectionId" value="{{ task.input.sectionId | escape }}">
        <input type="hidden" name="s3Bucket" value="{{ task.input.s3Bucket | escape }}">
    </crowd-form>

    <script>
        let currentZoom = 1;
        const imgElement = document.getElementById('documentImage');
        const imageContainer = document.getElementById('imageContainer');
        const imageWrapper = document.getElementById('imageWrapper');

        function initImage() {
            const containerRect = imageContainer.getBoundingClientRect();
            const imgAspect = imgElement.naturalWidth / imgElement.naturalHeight;
            const containerAspect = containerRect.width / containerRect.height;
            
            if (imgAspect > containerAspect) {
                imgElement.style.width = '100%';
                imgElement.style.height = 'auto';
            } else {
                imgElement.style.width = 'auto';
                imgElement.style.height = '100%';
            }
        }

        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.25, 4);
            imgElement.style.transform = `scale(${currentZoom})`;
        }

        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.25, 0.25);
            imgElement.style.transform = `scale(${currentZoom})`;
        }

        function resetView() {
            currentZoom = 1;
            imgElement.style.transform = `scale(${currentZoom})`;
            imageContainer.scrollLeft = 0;
            imageContainer.scrollTop = 0;
        }

        function toggleInfo() {
            const content = document.getElementById('infoContent');
            const icon = document.getElementById('toggleIcon');
            content.classList.toggle('expanded');
            icon.textContent = content.classList.contains('expanded') ? '‚ñ≤' : '‚ñº';
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function toggleSubmit() {
            const checkbox = document.getElementById('reviewComplete');
            const submitBtn = document.getElementById('submitButton');
            
            if (checkbox.checked) {
                submitBtn.classList.add('enabled');
                submitBtn.disabled = false;
            } else {
                submitBtn.classList.remove('enabled');
                submitBtn.disabled = true;
            }
        }

        function highlightField(element) {
            document.querySelectorAll('.key-value-pair').forEach(el => {
                el.style.borderColor = 'var(--border-gray)';
            });
            element.style.borderColor = 'var(--primary-blue)';
        }
    </script>
</body>
</html>
